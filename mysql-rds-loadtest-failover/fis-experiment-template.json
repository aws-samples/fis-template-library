{
    "description": "MySQL RDS Load Test and Failover Experiment",
    "targets": {
        "EC2Instance": {
            "resourceType": "aws:ec2:instance",
            "resourceArns": [
                "arn:aws:ec2:us-east-1:456498356358:instance/i-0cfb85a0e5b50a836"
            ],
            "selectionMode": "ALL"
        },
        "RDSCluster": {
            "resourceType": "aws:rds:db",
            "selectionMode": "ALL",
            "filters": [
                {
                    "path": "State.Name",
                    "values": [
                        "available"
                    ]
                },
                {
                    "path": "MultiAZ",
                    "values": [
                        "true"
                    ]
                }
            ]
        }
    },
    "actions": {
        "RunLoadTest": {
            "actionId": "aws:ssm:send-command",
            "description": "Run MySQL load test using Systems Manager document",
            "parameters": {
                "documentArn": "arn:aws:ssm:us-east-1:456498356358:document/RunMySQLLoadTest",
                "documentParameters": "{\"Duration\":\"300\",\"Concurrency\":\"10\",\"DBHost\":\"{{ RESOURCE_ARN }}\",\"DBName\":\"testdb\",\"DBUsername\":\"admin\"}",
                "duration": "PT10M"
            },
            "targets": {
                "Instances": "EC2Instance"
            }
        },
        "ForceFailover": {
            "actionId": "aws:rds:reboot-db-instance",
            "description": "Force a failover by rebooting the primary instance with failover",
            "parameters": {
                "forceFailover": "true",
                "startTime": "PT2M"
            },
            "targets": {
                "Instances": "RDSCluster"
            }
        }
    },
    "stopConditions": [
        {
            "source": "aws:cloudwatch:alarm",
            "value": "arn:aws:cloudwatch:us-east-1:456498356358:alarm:RDSHighCPUAlarm"
        }
    ],
    "roleArn": "arn:aws:iam::456498356358:role/FISExperimentRole",
    "logConfiguration": {
        "logSchemaVersion": 2,
        "cloudWatchLogsConfiguration": {
            "logGroupArn": "arn:aws:logs:us-east-1:456498356358:log-group:/aws/fis/experiment:*"
        }
    },
    "tags": {
        "Name": "MySQL-RDS-LoadTest-Failover",
        "Environment": "Test",
        "Application": "RDS-Failover-Testing"
    },
    "experimentOptions": {
        "accountTargeting": "single-account",
        "emptyTargetResolutionMode": "fail"
    }
}
